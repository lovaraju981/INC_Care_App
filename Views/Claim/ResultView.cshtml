@model List<INC_Care_App.Models.DTOs.ClaimInfo>
@{
    ViewData["Title"] = "Processed Claims";
}

<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

<style>
    body {
        background-color: #f8f9fa;
    }

    .result-container {
        max-width: 95%;
        margin: auto;
        padding: 2rem;
    }

    th, td {
        vertical-align: middle;
    }

    .table-wrapper {
        overflow-x: auto;
    }

    .fw-bold.red {
        color: #dc3545;
    }

    .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .filters .form-control {
        min-width: 200px;
    }
</style>

<div class="result-container">
    <div class="card shadow border-0">
        <div class="card-header bg-success text-white text-center">
            <h4 class="mb-0"><i class="bi bi-table"></i> Processed Claims</h4>
        </div>
        <div class="card-body">
            @if (!Model.Any())
            {
                <div class="alert alert-warning">No claims were processed.</div>
            }
            else
            {
                <div class="filters">
                    <select id="sourceFilter" class="form-select">
                        <option value="">Filter by Source</option>
                        <option value="HERITAGE">HERITAGE HEALTH INSURANCE TPA PVT. LTD</option>
                        <option value="ICICI">ICICI Lombard Health Care</option>
                        <option value="UNKNOWN">HDFC BANK</option>
                    </select>

                    <input type="text" id="patientFilter" class="form-control" placeholder="Search Patient Name..." />
                </div>

                <div class="table-wrapper">
                    <table id="claimsTable" class="table table-bordered table-striped align-middle">
                        <thead class="table-success text-center">
                            <tr>
                                <th>Source</th>
                                <th>Proposer</th>
                                <th>Patient</th>
                                <th>I-Card No</th>
                                <th>Policy No</th>
                                <th>Hospital</th>
                                <th>DOA</th>
                                <th>Claimed</th>
                                <th>Settled</th>
                                <th>Difference</th>
                                <th>Deductions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>@item.Source</td>
                                    <td>@item.Proposer</td>
                                    <td>@item.Patient</td>
                                    <td>@item.ICardNumber</td>
                                    <td>@item.PolicyNumber</td>
                                    <td>@item.HospitalName</td>
                                    <td class="text-nowrap">@item.DOA</td>
                                    <td class="text-end">@item.AmountClaimed</td>
                                    <td class="text-end">@item.AmountSettled</td>
                                    <td class="text-end fw-bold red">@item.Difference</td>
                                    <td style="min-width: 300px;">@Html.Raw(item.Deductions)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="text-end mt-4">
                    <a asp-action="Upload" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-left-circle"></i> Upload More
                    </a>
                </div>
            }
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
    $(document).ready(function () {
        var table = $('#claimsTable').DataTable({
            pageLength: 10
        });

        $('#sourceFilter').on('change', function () {
            table.column(0).search(this.value).draw();
        });

        $('#patientFilter').on('keyup', function () {
            table.column(2).search(this.value).draw();
        });
    });
</script>
